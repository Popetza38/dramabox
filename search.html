<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå - DramaBox">
    <meta name="theme-color" content="#0F0F23">

    <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå - DramaBox</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé¨</text></svg>">

    <!-- Google Fonts - Niramit -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Niramit:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <a href="index.html" class="logo">
                <div class="logo-icon">
                    <i data-lucide="play"></i>
                </div>
                <span>DramaBox</span>
            </a>

            <!-- Desktop Nav -->
            <nav class="nav-desktop">
                <a href="index.html">
                    <i data-lucide="home"></i>
                    ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                </a>
                <a href="index.html#categories">
                    <i data-lucide="grid-3x3"></i>
                    ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
                </a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <!-- Search Input -->
            <div class="search-input-large">
                <form onsubmit="handleSearchSubmit(event)">
                    <input type="text" id="search-query" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..."
                        autocomplete="off" autofocus>
                </form>
            </div>

            <!-- Search Results Info -->
            <div id="search-info" class="search-results-info"></div>

            <!-- Search Results -->
            <section class="drama-section">
                <div id="search-results" class="drama-grid">
                    <!-- Results will be loaded dynamically -->
                </div>
            </section>

            <!-- Empty State -->
            <div id="empty-state" class="empty-state hidden">
                <i data-lucide="search-x"></i>
                <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
            </div>

            <!-- Initial State -->
            <div id="initial-state" class="empty-state">
                <i data-lucide="search"></i>
                <p>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>¬© 2026 DramaBox - ‡∏î‡∏π‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ü‡∏£‡∏µ ‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢</p>
    </footer>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav">
        <a href="index.html" class="bottom-nav-item">
            <i data-lucide="home"></i>
            <span>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
        </a>
        <a href="search.html" class="bottom-nav-item active">
            <i data-lucide="search"></i>
            <span>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</span>
        </a>
        <a href="index.html#categories" class="bottom-nav-item">
            <i data-lucide="grid-3x3"></i>
            <span>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</span>
        </a>
        <a href="#" class="bottom-nav-item">
            <i data-lucide="heart"></i>
            <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î</span>
        </a>
    </nav>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Initialize Lucide Icons
        lucide.createIcons();

        // Check for query param on load
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const query = urlParams.get('q');

            if (query) {
                document.getElementById('search-query').value = query;
                performSearch(query);
            }
        });

        // Handle search form submit
        function handleSearchSubmit(event) {
            event.preventDefault();
            const query = document.getElementById('search-query').value.trim();
            if (query) {
                // Update URL
                const newUrl = `search.html?q=${encodeURIComponent(query)}`;
                window.history.pushState({}, '', newUrl);
                performSearch(query);
            }
        }

        // Perform search
        async function performSearch(keyword) {
            const resultsContainer = document.getElementById('search-results');
            const searchInfo = document.getElementById('search-info');
            const emptyState = document.getElementById('empty-state');
            const initialState = document.getElementById('initial-state');

            // Hide initial state
            initialState.classList.add('hidden');
            emptyState.classList.add('hidden');

            // Show loading
            resultsContainer.innerHTML = `
                <div class="skeleton skeleton-card"></div>
                <div class="skeleton skeleton-card"></div>
                <div class="skeleton skeleton-card"></div>
                <div class="skeleton skeleton-card"></div>
            `;

            try {
                const data = await DramaAPI.search(keyword);
                const results = data.data || [];

                if (results.length === 0) {
                    resultsContainer.innerHTML = '';
                    searchInfo.textContent = '';
                    emptyState.classList.remove('hidden');
                    return;
                }

                // Show results count
                searchInfo.textContent = `‡∏û‡∏ö ${results.length} ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "${keyword}"`;

                // Render results
                resultsContainer.innerHTML = results.map(drama => createDramaCard(drama)).join('');

                // Re-initialize icons
                lucide.createIcons();

                // Add animations
                resultsContainer.querySelectorAll('.drama-card').forEach((card, index) => {
                    card.style.animationDelay = `${index * 0.05}s`;
                    card.classList.add('fade-in');
                });

            } catch (error) {
                console.error('Search failed:', error);
                resultsContainer.innerHTML = '';
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà',
                    customClass: { popup: 'swal2-dark' }
                });
            }
        }

        // Create drama card (copied from main.js for standalone use)
        function createDramaCard(drama) {
            const id = drama.bookId || drama.id;
            const name = drama.bookName || drama.name;
            const cover = drama.coverWap || drama.cover;
            const chapterCount = drama.chapterCount || 0;
            const playCount = drama.playCount || '0';
            const cornerName = drama.corner?.name || drama.cornerName || '';

            return `
                <a href="detail.html?id=${id}" class="drama-card">
                    <div class="drama-card-image">
                        <img src="${cover}" alt="${name}" loading="lazy">
                        <div class="drama-card-overlay">
                            <div class="play-icon">
                                <i data-lucide="play"></i>
                            </div>
                        </div>
                        ${cornerName ? `<span class="drama-card-badge">${cornerName}</span>` : ''}
                    </div>
                    <div class="drama-card-content">
                        <h3 class="drama-card-title">${name}</h3>
                        <div class="drama-card-meta">
                            <span><i data-lucide="film"></i> ${chapterCount}</span>
                            <span><i data-lucide="eye"></i> ${playCount}</span>
                        </div>
                    </div>
                </a>
            `;
        }

        // Debounced live search
        let searchTimeout;
        document.getElementById('search-query').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim();

            if (query.length >= 2) {
                searchTimeout = setTimeout(() => {
                    const newUrl = `search.html?q=${encodeURIComponent(query)}`;
                    window.history.replaceState({}, '', newUrl);
                    performSearch(query);
                }, 500);
            }
        });
    </script>
</body>

</html>