<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เช็ครายวัน - DramaPop</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/pages.css">
</head>

<body>
    <header class="top-nav">
        <div class="nav-container">
            <button class="btn-back" onclick="history.back()"><i class="fas fa-arrow-left"></i></button>
            <h1 class="page-title">เช็ครายวัน</h1>
            <div style="width:40px"></div>
        </div>
    </header>

    <main class="main-content page-content">
        <div class="vip-card" style="background: linear-gradient(135deg, #6366f1 0%, #ec4899 100%);">
            <i class="fas fa-coins vip-icon"></i>
            <h2 class="vip-title">รับ Points ฟรีทุกวัน!</h2>
            <p class="vip-subtitle">เช็คอินติดต่อกัน 7 วัน รับ Points สูงสุด 100</p>
            <div class="profile-stats" style="margin-top: 0;">
                <div class="stat-item">
                    <div class="stat-value" id="current-points">0</div>
                    <div class="stat-label">Points ปัจจุบัน</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="current-streak">0</div>
                    <div class="stat-label">วันติดต่อกัน</div>
                </div>
            </div>
        </div>

        <h3 style="margin-bottom: var(--spacing-md);">รางวัล 7 วัน</h3>
        <div class="daily-grid" id="daily-grid">
            <!-- Generated by JS -->
        </div>

        <button class="btn btn-primary btn-lg btn-block" id="btn-checkin">
            <i class="fas fa-calendar-check"></i> เช็คอินวันนี้
        </button>

        <div class="menu-list" style="margin-top: var(--spacing-xl);">
            <div class="menu-item" style="cursor: default;">
                <i class="fas fa-info-circle"></i>
                <span>Points ใช้ข้ามโฆษณาได้ (10 Points/ครั้ง)</span>
            </div>
        </div>
    </main>

    <nav class="bottom-nav">
        <a href="index.html" class="nav-item"><i class="fas fa-home"></i><span>หน้าแรก</span></a>
        <a href="category.html" class="nav-item"><i class="fas fa-compass"></i><span>สำรวจ</span></a>
        <a href="daily-check.html" class="nav-item active"><i
                class="fas fa-calendar-check"></i><span>เช็ครายวัน</span></a>
        <a href="history.html" class="nav-item"><i class="fas fa-history"></i><span>ประวัติ</span></a>
        <a href="profile.html" class="nav-item"><i class="fas fa-user"></i><span>โปรไฟล์</span></a>
    </nav>

    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/utils.js"></script>
    <script>
        const REWARDS = CONFIG.DAILY_REWARDS;
        const DAYS = ['วันที่ 1', 'วันที่ 2', 'วันที่ 3', 'วันที่ 4', 'วันที่ 5', 'วันที่ 6', 'วันที่ 7'];

        document.addEventListener('DOMContentLoaded', () => {
            renderDailyGrid();
            updateUI();

            document.getElementById('btn-checkin').addEventListener('click', doCheckin);
        });

        function renderDailyGrid() {
            const grid = document.getElementById('daily-grid');
            const checkData = Storage.dailyCheck.get();
            const currentStreak = checkData.streak || 0;
            const canCheck = Storage.dailyCheck.canCheck();

            grid.innerHTML = REWARDS.map((points, index) => {
                const dayNum = index + 1;
                const isChecked = dayNum <= currentStreak && !canCheck;
                const isToday = dayNum === (canCheck ? currentStreak + 1 : currentStreak);

                return `
                    <div class="daily-item ${isChecked ? 'checked' : ''} ${isToday && canCheck ? 'today' : ''}">
                        <span class="daily-day">${DAYS[index]}</span>
                        <span class="daily-reward">+${points}</span>
                        <i class="fas ${isChecked ? 'fa-check-circle' : 'fa-gift'} daily-icon"></i>
                    </div>
                `;
            }).join('');
        }

        function updateUI() {
            const checkData = Storage.dailyCheck.get();
            const points = Storage.points.get();
            const canCheck = Storage.dailyCheck.canCheck();

            document.getElementById('current-points').textContent = points;
            document.getElementById('current-streak').textContent = checkData.streak || 0;

            const btn = document.getElementById('btn-checkin');
            if (canCheck) {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-calendar-check"></i> เช็คอินวันนี้';
            } else {
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-check"></i> เช็คอินแล้ววันนี้';
            }
        }

        function doCheckin() {
            const result = Storage.dailyCheck.check();
            if (result) {
                Swal.fire({
                    icon: 'success',
                    title: 'เช็คอินสำเร็จ!',
                    html: `
                        <p>วันที่ ${result.streak} ติดต่อกัน</p>
                        <p style="font-size: 2rem; color: #fbbf24; margin-top: 1rem;">+${result.reward} Points</p>
                    `,
                    background: '#1a1a25',
                    color: '#ffffff',
                    confirmButtonColor: '#6366f1'
                });
                renderDailyGrid();
                updateUI();
            } else {
                Utils.toast('คุณเช็คอินแล้ววันนี้', 'info');
            }
        }
    </script>
</body>

</html>